<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Color Clicker Game</title>
    <style>
        #grid {
            display: grid;
            grid-template-columns: repeat(5, 50px);
            gap: 5px;
        }

        .cell {
            width: 50px;
            height: 50px;
            background-color: white;
            border: 1px solid black;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Color Clicker Game</h1>
    <div id="grid"></div>
    <button id="resetButton">Reset Grid</button>
    <div id="turnIndicator">Current Turn: Waiting on players...</div>
    <div id="playerIndicator">Player #</div>
    <h3 id="playerWins">Games Won: 0</h3>
    <div id="trophySection">
        <!-- Trophy images will appear here -->
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/gameHub")
            .build();

        connection.start().then(() => {
            console.log("Connected to SignalR hub.");
            // Initialize the grid for the first time
            connection.invoke("ResetGrid").catch(err => console.error(err.toString()));
        }).catch(err => console.error("Error starting connection:", err.toString()));

        let gamesWon = 0; // Initial win count
        const gridElement = document.getElementById("grid");
        const gridSize = 5;

        connection.on("UpdateGrid", (grid) => {
            console.log("Received grid update:", grid); // Debugging
            gridElement.innerHTML = ""; // Clear grid

            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement("div");
                cell.className = "cell";
                cell.style.backgroundColor = grid[i] || "white";
                if (!grid[i]) {
                    cell.addEventListener("click", () => {
                        connection.invoke("ClickCell", i).catch(err => console.error(err.toString()));
                    });
                }
                gridElement.appendChild(cell);
            }

        });

        document.getElementById("resetButton").addEventListener("click", () => {
            connection.invoke("ResetGrid").catch(err => console.error(err.toString()));
        });

        connection.on("PlayerIdStatus", (currentPlayer, connectionId) => {
            console.log(connectionId, " is ready as ", currentPlayer);
            if (connectionId === connection.connectionId) {
                document.getElementById("playerIndicator").innerText = `You are ${currentPlayer}`;
            }
        });

        connection.on("PlayerTurnStatus", (currentPlayer) => {
            console.log("Current player is:", currentPlayer);
            document.getElementById("turnIndicator").innerText = `Current Turn: ${currentPlayer}`;
        });

        connection.on("DeclareWinner", (currentPlayer) => {
            // Show an alert notifying the winner
            alert(`Congratulations! ${currentPlayer} has won the game!`);
            gamesWon++;
            document.getElementById("playerWins").innerText = `Games Won: ${gamesWon}`;
            addTrophy();
        });

        function AddTrophy() {
            const trophySection = document.getElementById("trophySection");
            const trophyImage = document.createElement("img");
            trophyImage.src = "https://cdn-icons-png.flaticon.com/512/1828/1828884.png";
            trophyImage.alt = "Valuable Trophy";
            trophyImage.classList.add("trophy");
            trophyImage.appendChild(trophyImage);

        }
    </script>
</body>
</html>
